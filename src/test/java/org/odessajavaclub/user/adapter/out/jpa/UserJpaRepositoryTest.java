package org.odessajavaclub.user.adapter.out.jpa;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

import java.util.List;
import org.junit.jupiter.api.Test;
import org.odessajavaclub.user.domain.UserRole;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.data.domain.Pageable;

@DataJpaTest
class UserJpaRepositoryTest {

  @Autowired
  private UserJpaRepository userJpaRepository;

  @Test
  void userIdIsAutoGenerated() {
    UserEntity saved = userJpaRepository.save(new UserEntity(null,
                                                             "New",
                                                             "User",
                                                             "new@email.com",
                                                             "pass123",
                                                             UserEntityRole.USER,
                                                             true));

    assertNotNull(saved.getId());
  }

  @Test
  void findAllByActiveTrue() {
    UserEntity entity1 = new UserEntity(null,
                                        "New1",
                                        "User1",
                                        "new1@email.com",
                                        "pass123",
                                        UserEntityRole.USER,
                                        true);
    UserEntity entity2 = new UserEntity(null,
                                        "New2",
                                        "User2",
                                        "new2@email.com",
                                        "pass123",
                                        UserEntityRole.USER,
                                        false);
    userJpaRepository.save(entity1);
    userJpaRepository.save(entity2);

    List<UserEntity> actual = userJpaRepository.findAllByActive(true, Pageable.unpaged());
    assertEquals(1, actual.size());
    assertEquals(entity1, actual.get(0));
  }

  @Test
  void findAllByActiveFalse() {
    UserEntity entity1 = new UserEntity(null,
                                        "New1",
                                        "User1",
                                        "new1@email.com",
                                        "pass123",
                                        UserEntityRole.USER,
                                        true);
    UserEntity entity2 = new UserEntity(null,
                                        "New2",
                                        "User2",
                                        "new2@email.com",
                                        "pass123",
                                        UserEntityRole.USER,
                                        false);
    userJpaRepository.save(entity1);
    userJpaRepository.save(entity2);

    List<UserEntity> actual = userJpaRepository.findAllByActive(false, Pageable.unpaged());
    assertEquals(1, actual.size());
    assertEquals(entity2, actual.get(0));
  }
}
